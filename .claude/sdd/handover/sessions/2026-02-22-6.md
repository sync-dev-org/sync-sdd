# Session Handover
**Generated**: 2026-02-22
**Branch**: main
**Session Goal**: Agent Teams → SubAgent 全面移行 (v0.20.0)

## Direction
### Immediate Next Action
ユーザー指示を待つ。

### Active Goals
- [x] Agent Teams → SubAgent 全面移行
- [x] v0.20.0 リリース

### Key Decisions
**Continuing from previous sessions:**
1. 細かめ粒度 (15 spec) を採用 (ref D2)
2. 全 spec を `implementation-complete` で作成 — 既存実装が正 (ref D1)
3. 6 Wave 構成 (ref D2)
4. cpf-protocol は横断的仕様、改修時は3 spec 影響確認必要
5. Write Fallback Protocol — knowledge buffer に記録
6. Roadmap 常時必須 — 全て /sdd-roadmap 経由 (ref D19)
7. Router化 — design/impl/review サブコマンド (ref D19)
8. ファイルベースレビュー (ref D19)
9. Recovery Protocol 廃止 (ref D19)
10. .gitignore: インストール済みフレームワーク除外、project/handover は tracked 維持 (ref D22)

**Added this session:**
11. Agent Teams → SubAgent 移行 — TeammateTool/SendMessageTool 廃止、Task(subagent_type=...) に統一 (ref D29)
12. エージェント定義を `.claude/agents/` に移動、YAML frontmatter (name, description, model, tools) (ref D29)
13. 出力抑制の理由変更: idle notification 漏洩防止 → Lead コンテキストバジェット保護 (ref D29)
14. ファイルベースレビュー維持 — Auditor は引き続き必要（cross-finding 分析、Product Intent チェック、コンテキスト分離）
15. settings.json から AGENT_TEAMS 環境変数削除 (ref D29)
16. ツール許可は最小権限 — Task ツール全エージェント不許可、Bash は Builder/inspector-test/inspector-e2e のみ (ref D29)
17. Inspector body の WebSearch/WebFetch/Bash 指示は tools に含まれないなら削除（レビュー指摘で修正）

**Obsoleted decisions (Agent Teams 関連):**
- ~~11. Agent Teams API 依存をフォールバックなしで受容 (ref D10)~~ → SubAgent に移行済み
- ~~15. Agent 定義を sdd/settings/agents/ に移動 (ref D19)~~ → .claude/agents/ に変更
- ~~21. Review teammate テキスト出力抑制 — idle notification 経由のコンテキスト漏洩防止~~ → コンテキストバジェット保護に理由変更

### Warnings
- **Cross-check Tracked issues 27件** (H8, M15, L6) — `verdicts-cross-check.md` 参照。実装ブロックなし
- **template drift 10/15 spec** — Error Handling / Testing Strategy / Specs Traceability セクション欠落（体系的）
- `.claude/` 配下はインストール先。編集対象は `framework/` のみ。反映は `bash install.sh --local --force`
- **マージ無断実行インシデント (D29 session)**: 「コミットだけ」指示に対しマージ+ブランチ削除を実行。MEMORY.md に記録済み。不可逆操作は必ず明示的確認を取ること
- **SubAgent 動作未検証**: v0.20.0 は構造変更のみ。実際に /sdd-roadmap で SubAgent パイプラインを動かした検証は未実施

## Session Context
### Tone and Nuance
ユーザーは効率重視。正規パイプライン経由を徹底。
「動くか？」を重視 — シナリオシミュレーションで齟齬を網羅的に検出する姿勢。
アーキテクチャ変更に対して「プロコンをちゃんと提示」を求める。
指示の範囲を厳密に守ること — 「だけ」は文字通り「だけ」。不可逆操作を勝手に追加しない。
Agent Teams の内部動作を正確に把握しており、SubAgent 移行の動機は実体験に基づく（Lead が規約を守れないという実観測）。

### Steering Exceptions
なし

## Accomplished
- **Agent Teams → SubAgent 全面移行 (v0.20.0)**
  - **core-architecture** v1.1.0→v1.2.0 (Full Revise): CLAUDE.md SubAgent 書き換え、23 agent 移動+YAML化、settings.json AGENT_TEAMS 削除
  - **6 spec 軽量 Revise**: design-pipeline, task-generation, tdd-execution, design-review, impl-review, dead-code-review — design.md パス/用語更新 + spec.yaml パス更新
  - **installer** v1.1.0→v1.2.0 (Full Revise): install.sh パス変更、v0.20.0 migration、AGENT_TEAMS ガイダンス削除
  - **roadmap-orchestration** v1.2.0→v1.3.0 (Full Revise): SKILL.md 全 TeammateTool → Task(subagent_type=...) 置換
  - **レビュー指摘 13件修正**: C1 (Task allowed-tools), H1 (step ref), M1-M6 (tools/flow整合), L1/L3 (用語/ハンドリング)
  - **v0.20.0 リリース**: VERSION, README.md, install.sh 更新、release/v0.20.0 + tag push

### Modified Files
- `framework/claude/CLAUDE.md`
- `framework/claude/settings.json`
- `framework/claude/skills/sdd-roadmap/SKILL.md`
- `framework/claude/agents/sdd-*.md` (23 files — 移動+YAML化+出力抑制更新)
- `framework/claude/sdd/settings/agents/` (削除)
- `install.sh`
- `VERSION`, `README.md`
- `.claude/sdd/project/specs/*/design.md` (9 specs)
- `.claude/sdd/project/specs/*/spec.yaml` (9 specs)
- `.claude/sdd/handover/decisions.md`

## Resume Instructions
1. `session.md` を読み込み、Direction と Warnings を確認
2. ユーザー指示を待つ（SubAgent 動作検証、次のフィーチャー開発、または残課題対応）
